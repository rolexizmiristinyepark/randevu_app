import{s as e,a as t,b as n,c as a,h as s,d as i,e as o,f as l}from"./base-layer-CvqQT6FP.js";import{D as c}from"./utils-D-0zHxs0.js";import{a as r}from"./api-Dvpp0-ro.js";import{c as d}from"./security-zfds8hUd.js";const m={},u=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=e?.nonce||e?.getAttribute("nonce");a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/randevu_app/"+e}(e))in m)return;m[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})};async function p(n,a){e.set("selectedAppointmentType","management"),e.set("selectedStaff",0),e.set("managementContactPerson",n),window.managementContactPerson=n,document.querySelectorAll(".management-sub-btn").forEach(e=>{e.classList.remove("selected")});const s=document.querySelector(`[data-management="${n}"]`);s&&s.classList.add("selected");const i=document.getElementById("staffHeader");i&&(i.textContent=a,i.style.visibility="visible");const{renderCalendar:o,loadMonthData:l}=await u(async()=>{const{renderCalendar:e,loadMonthData:t}=await Promise.resolve().then(()=>_);return{renderCalendar:e,loadMonthData:t}},void 0);t("calendarSection"),o(),await l()}async function f(n){if("management"===n){const t=document.getElementById("typeManagement"),n=document.getElementById("managementSubOptions");if(!t||!n)return;if(n.classList.contains("show"))n.classList.remove("show"),t.classList.remove("management-expanded"),t.classList.remove("selected"),e.set("selectedAppointmentType",null);else{const e=document.querySelector(".type-card.selected");if(e){e.classList.remove("selected");const t=e.querySelector(".management-sub-options");t&&t.classList.remove("show")}t.classList.add("selected"),t.classList.add("management-expanded"),n.style.display="flex",setTimeout(()=>{n.classList.add("show")},10)}return}e.set("selectedAppointmentType",n);const a=document.querySelector(".type-card.selected");if(a){a.classList.remove("selected"),a.classList.remove("management-expanded");const e=a.querySelector(".management-sub-options");e&&(e.classList.remove("show"),setTimeout(()=>{e.style.display="none"},400))}const s=document.querySelector(`.type-card[data-type="${n}"]`);s&&s.classList.add("selected");const{renderCalendar:i,loadMonthData:o}=await u(async()=>{const{renderCalendar:e,loadMonthData:t}=await Promise.resolve().then(()=>_);return{renderCalendar:e,loadMonthData:t}},void 0);t("calendarSection"),i(),await o()}const g={selectAppointmentType:f,selectManagementContact:p};function y(e,t={}){console.error("[App Error]",e,t)}function S(){"undefined"!=typeof window&&("localhost"!==window.location.hostname&&window.location.hostname.includes("127.0.0.1"),window.addEventListener("error",e=>{console.error("[Global Error]",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{console.error("[Unhandled Promise Rejection]",e.reason)}))}function h(e,t=300){let n=null;return function(...a){null!==n&&clearTimeout(n),n=setTimeout(()=>{e(...a),n=null},t)}}function v(e,t){const n=new Map,a=function(...a){const s=t?t(...a):JSON.stringify(a);if(n.has(s))return n.get(s);const i=e(...a);return n.set(s,i),i};return a.cache=n,a.clearCache=()=>n.clear(),a}"undefined"!=typeof window&&(window.selectAppointmentType=f,window.selectManagementContact=p,window.TypeSelector=g);const w={debounce:h,throttle:function(e,t=100){let n=!1;return function(...a){n||(e(...a),n=!0,setTimeout(()=>{n=!1},t))}},memoize:v,memoizeWithTTL:function(e,t=3e5,n){const a=new Map,s=function(...s){const i=n?n(...s):JSON.stringify(s),o=a.get(i);if(o&&Date.now()<o.expiry)return o.value;const l=e(...s);return a.set(i,{value:l,expiry:Date.now()+t}),l};return s.cache=a,s.clearCache=()=>a.clear(),s},deduplicateRequests:function(e,t){const n=new Map,a=async function(...a){const s=t?t(...a):JSON.stringify(a);if(n.has(s))return n.get(s);const i=e(...a).finally(()=>{n.delete(s)});return n.set(s,i),i};return a.pendingRequests=n,a.clearPending=()=>n.clear(),a},batch:function(e,t=0){let n=[],a=null;return function(s){n.push(s),null!==a&&clearTimeout(a),a=setTimeout(()=>{e(n),n=[],a=null},t)}}};"undefined"!=typeof window&&(window.PerformanceUtils=w);const b=18e5;async function E(t){const n=e.get("currentMonth");n.setMonth(n.getMonth()+t),e.set("currentMonth",n);const s=`${n.toISOString().slice(0,7)}_${e.get("specificStaffId")||"all"}_${e.get("selectedAppointmentType")||"general"}`;if(a.has(s)){const t=a.get(s);if(t&&Date.now()-t.timestamp<b)return e.set("dayShifts",t.data.dayShifts||{}),e.set("allAppointments",t.data.allAppointments||{}),e.set("googleCalendarEvents",t.data.googleCalendarEvents||{}),C(),void T()}T(),await D()}function T(){const t=e.get("currentMonth"),n=document.getElementById("calendarGrid");if(!n)return;const a=document.getElementById("currentMonth");a&&(a.textContent=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"][t.getMonth()]+" "+t.getFullYear()),n.innerHTML="";const s=document.createDocumentFragment();["Pzt","Sal","Çar","Per","Cum","Cmt","Paz"].forEach(e=>{const t=document.createElement("div");t.className="day-header",t.textContent=e,s.appendChild(t)});let i=new Date(t.getFullYear(),t.getMonth(),1).getDay();i=0===i?6:i-1;for(let e=0;e<i;e++){const e=document.createElement("div");e.className="calendar-day other-month",s.appendChild(e)}const o=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),l=new Date;l.setHours(0,0,0,0);const r=e.get("specificStaffId"),d=e.get("selectedAppointmentType"),m=e.get("isManagementLink");for(let e=1;e<=o;e++){const n=document.createElement("div");n.className="calendar-day",n.textContent=String(e);const a=new Date(t.getFullYear(),t.getMonth(),e);a.setHours(0,0,0,0);const i=c.toLocalDate(a);n.setAttribute("data-date",i);const o="0"===r||"management"===d||m;if(a<l||a.getTime()===l.getTime()&&!o)n.classList.add("past");else{const e=A(i);e.available?(n.classList.add("available"),n.onclick=()=>{M(i)}):(n.classList.add("unavailable"),n.title=e.reason||"Müsait değil")}s.appendChild(n)}n.appendChild(s)}const A=v(function(t){const n=e.get("selectedAppointmentType"),a=e.get("specificStaffId"),s=e.get("dayShifts"),i=e.get("googleCalendarEvents");if("management"===n)return{available:!0};if(a&&"0"!==a){if(!s[t]||!s[t][parseInt(a)])return{available:!1,reason:"İlgili çalışan bu gün müsait değil"}}else if(!(s[t]&&Object.keys(s[t]).length>0))return{available:!1,reason:"Çalışan yok"};const o=i[t]||[],l=new Date,r=c.toLocalDate(l),d=o.filter(e=>{const n=e.extendedProperties?.private?.appointmentType;return("delivery"===n||"shipping"===n)&&!(t===r&&e.start&&(e.start.time||(()=>{const t=new Date(e.start.dateTime);return String(t.getHours()).padStart(2,"0")+":"+String(t.getMinutes()).padStart(2,"0")})())<String(l.getHours()).padStart(2,"0")+":"+String(l.getMinutes()).padStart(2,"0"))}).length;if("delivery"===n||"shipping"===n){const e=window.CONFIG?.MAX_DAILY_DELIVERY_APPOINTMENTS||4;if(d>=e)return{available:!1,reason:`Teslim/gönderi randevuları dolu (${d}/${e})`}}return{available:!0}});function C(){A.clearCache()}async function M(n){e.set("selectedDate",n);const a=e.get("specificStaffId"),s=e.get("selectedAppointmentType"),i=e.get("isManagementLink"),o=e.get("dayShifts"),c=document.querySelector(".calendar-day.selected");c&&c.classList.remove("selected");const r=document.querySelector(`.calendar-day[data-date="${n}"]`);if(r&&r.classList.add("selected"),"0"===a&&"management"===s){e.set("selectedStaff",0),e.set("selectedShiftType","management");const{displayAvailableTimeSlots:n}=await u(async()=>{const{displayAvailableTimeSlots:e}=await Promise.resolve().then(()=>$);return{displayAvailableTimeSlots:e}},void 0);n(),t("timeSection"),l("staffSection"),l("detailsSection");const a=document.getElementById("submitBtn");a&&(a.style.display="none")}else if("0"===a&&"management"!==s){const{displayAvailableStaff:e}=await u(async()=>{const{displayAvailableStaff:e}=await Promise.resolve().then(()=>N);return{displayAvailableStaff:e}},void 0);e(),t("staffSection"),l("timeSection"),l("detailsSection");const n=document.getElementById("submitBtn");n&&(n.style.display="none")}else if(a||i)if(i){e.set("selectedShiftType","management");const{displayAvailableTimeSlots:n}=await u(async()=>{const{displayAvailableTimeSlots:e}=await Promise.resolve().then(()=>$);return{displayAvailableTimeSlots:e}},void 0);n(),l("staffSection"),t("timeSection"),l("detailsSection");const a=document.getElementById("submitBtn");a&&(a.style.display="none")}else{e.set("selectedStaff",parseInt(a));const s=o[n]?.[parseInt(a)];if(s){e.set("selectedShiftType",s);const{displayAvailableTimeSlots:n}=await u(async()=>{const{displayAvailableTimeSlots:e}=await Promise.resolve().then(()=>$);return{displayAvailableTimeSlots:e}},void 0);n(),t("timeSection"),l("detailsSection");const a=document.getElementById("submitBtn");a&&(a.style.display="none")}}else{const{displayAvailableStaff:e}=await u(async()=>{const{displayAvailableStaff:e}=await Promise.resolve().then(()=>N);return{displayAvailableStaff:e}},void 0);e(),t("staffSection"),l("timeSection"),l("detailsSection");const n=document.getElementById("submitBtn");n&&(n.style.display="none")}}async function D(){const t=e.get("currentMonth"),l=e.get("specificStaffId"),d=new Date(t.getFullYear(),t.getMonth(),1),m=new Date(t.getFullYear(),t.getMonth()+1,0),u=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;n();try{const e=sessionStorage.getItem("dataVersion"),t=await r("getDataVersion");if(t.success&&t.data){const n=String(t.data);e&&e!==n&&(a.clear(),(()=>{window.CONFIG})("Cache invalidated: version changed",{old:e,new:n})),sessionStorage.setItem("dataVersion",n)}}catch(f){(()=>{window.CONFIG})("Version check failed, continuing with cache:",f)}const p=`${u}_${l||"all"}_${e.get("selectedAppointmentType")||"general"}`;if(a.has(p)){const t=a.get(p);if(t&&Date.now()-t.timestamp<b)return e.set("dayShifts",t.data.dayShifts||{}),e.set("allAppointments",t.data.allAppointments||{}),e.set("googleCalendarEvents",t.data.googleCalendarEvents||{}),C(),T(),void s()}try{console.error("[DEBUG] loadMonthData: starting API calls, month:",u,"staff:",l);const[t,n,o]=await Promise.all([r("getMonthShifts",{month:u}),r("getMonthAppointments",{month:u}),r("getGoogleCalendarEvents",{startDate:c.toLocalDate(d),endDate:c.toLocalDate(m),staffId:l||"all"})]);console.error("[DEBUG] loadMonthData: API results",{shifts:t.success?Object.keys(t.data||{}).length:"FAIL",appointments:n.success,calendar:o.success}),t.success&&e.set("dayShifts",t.data||{}),n.success&&e.set("allAppointments",n.data||{}),o.success&&e.set("googleCalendarEvents",o.data||{});const f=e.get("dayShifts"),g=e.get("allAppointments"),y=e.get("googleCalendarEvents");a.set(p,{timestamp:Date.now(),data:{dayShifts:{...f},allAppointments:{...g},googleCalendarEvents:{...y}}}),C(),T(),s(),i()}catch(f){console.error("[DEBUG] loadMonthData CATCH ERROR:",f),((...e)=>{window.CONFIG?.DEBUG&&console.error(...e)})("Data loading error:",f),y(f,{context:"loadAllData"}),o("Takvim verileri yüklenemedi. Lütfen sayfayı yenileyin.","error"),s(),T()}}const L={renderCalendar:T,changeMonth:E,checkDayAvailability:A,selectDay:M,loadMonthData:D};"undefined"!=typeof window&&(window.changeMonth=E,window.renderCalendar=T,window.selectDay=M,window.CalendarComponent=L);const _=Object.freeze(Object.defineProperty({__proto__:null,CalendarComponent:L,changeMonth:E,checkDayAvailability:A,clearAvailabilityCache:C,loadMonthData:D,renderCalendar:T,selectDay:M},Symbol.toStringTag,{value:"Module"})),I=(...e)=>window.CONFIG?.DEBUG&&console.error(...e);async function x(){try{const t=await r("getStaff");t.success?e.set("staffMembers",t.data):I("Staff members could not be loaded:",t.error)}catch(t){I("API error:",t)}}async function k(){try{const e=await r("getSettings");if(e.success){const t=window.CONFIG,n=e.data;t&&(t.APPOINTMENT_HOURS=t.APPOINTMENT_HOURS||{},t.APPOINTMENT_HOURS.interval=n.interval||60,t.MAX_DAILY_DELIVERY_APPOINTMENTS=n.maxDaily||4)}}catch(e){I("Settings could not be loaded:",e)}}function P(){const t=document.getElementById("staffList");if(!t)return;t.innerHTML="";const n=e.get("staffMembers"),a=e.get("selectedDate"),s=e.get("dayShifts");if(0===n.length){const e=d("div",{style:"grid-column: 1/-1; text-align: center; padding: 40px;"}),n=d("div",{className:"spinner",style:"margin: 0 auto 20px;"}),a=d("button",{className:"btn",style:"padding: 12px 30px;"});return a.textContent="Yenile",a.addEventListener("click",()=>location.reload()),e.appendChild(n),e.appendChild(a),void t.appendChild(e)}const i=s[a]||{};n.forEach(e=>{if(!e.active)return;const n=i[e.id],a=!!n,s=document.createElement("div");s.className="staff-card"+(a?"":" unavailable");const o=d("div",{className:"staff-name"});o.textContent=e.name,s.appendChild(o),a?s.addEventListener("click",t=>{B(e.id,n,t)}):(s.style.opacity="0.5",s.style.cursor="not-allowed"),t.appendChild(s)})}async function B(n,a,s){e.set("selectedStaff",parseInt(String(n))),e.set("selectedShiftType",a);const i=e.get("staffMembers").find(e=>e.id===parseInt(String(n)));if(i){const e=document.getElementById("staffHeader");e&&(e.textContent=i.name,e.style.visibility="visible")}const o=document.querySelector(".staff-card.selected");o&&o.classList.remove("selected"),s&&s.currentTarget&&s.currentTarget.classList.add("selected");const{displayAvailableTimeSlots:c}=await u(async()=>{const{displayAvailableTimeSlots:e}=await Promise.resolve().then(()=>$);return{displayAvailableTimeSlots:e}},void 0);c(),t("timeSection"),l("detailsSection");const r=document.getElementById("submitBtn");r&&(r.style.display="none")}const O={loadStaffMembers:x,loadSettings:k,displayAvailableStaff:P,selectStaff:B};"undefined"!=typeof window&&(window.selectStaff=B,window.displayAvailableStaff=P,window.loadStaffMembers=x,window.loadSettings=k,window.StaffSelector=O);const N=Object.freeze(Object.defineProperty({__proto__:null,StaffSelector:O,displayAvailableStaff:P,loadSettings:k,loadStaffMembers:x,selectStaff:B},Symbol.toStringTag,{value:"Module"}));async function H(){const t=document.getElementById("timeSlots");if(!t)return;t.innerHTML='<div style="grid-column: 1/-1; text-align: center; padding: 20px;"><div class="spinner"></div></div>';const n=e.get("selectedDate"),a=e.get("selectedShiftType"),s=e.get("selectedAppointmentType"),i=e.get("isManagementLink"),o=e.get("managementLevel");if(i){if(!n||!s)return void(t.innerHTML='<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #dc3545;">Lütfen önce tarih ve randevu türü seçin.</div>')}else if(!n||!a||!s)return void(t.innerHTML='<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #dc3545;">Lütfen önce tarih, vardiya ve randevu türü seçin.</div>');try{if(i){const e=await r("getManagementSlotAvailability",{date:n,managementLevel:o});if(!e.success){const e=document.createElement("div");return e.style.cssText="grid-column: 1/-1; text-align: center; padding: 20px; color: #dc3545;",e.textContent="Müsait saatler yüklenemedi",void t.appendChild(e)}const{slots:a}=e.data;t.innerHTML="";const s=new Date,i=n===s.getFullYear()+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0"),l=s.getHours(),c=s.getMinutes(),d=[],m=new Set;return a.forEach(e=>{m.has(e.time)||(m.add(e.time),d.push(e))}),void d.forEach(e=>{const[n,a]=e.time.split(":").map(Number);if(0!==a)return;if(i&&(n<l||n===l&&a<=c))return;const s=document.createElement("div");e.available?(s.className="slot-btn",s.textContent=e.time,1===e.count&&(s.title="Bu saatte 1 randevu var (2. randevu olabilir)"),s.addEventListener("click",()=>F(e.time,s))):(s.className="slot-btn disabled",s.textContent=e.time,s.title="Bu saat dolu (2 randevu)",s.style.opacity="0.4",s.style.cursor="not-allowed",s.setAttribute("aria-disabled","true")),t.appendChild(s)})}if("management"===s){t.innerHTML="";const e=[];for(let t=10;t<=20;t++)e.push({time:`${t}:00`}),t<20&&e.push({time:`${t}:30`});const a=new Date,s=n===a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0"),i=a.getHours(),o=a.getMinutes();return void e.forEach(e=>{if(s){const[t,n]=e.time.split(":").map(Number);if(void 0!==t&&void 0!==n&&(t<i||t===i&&n<=o))return}const n=document.createElement("div");n.className="slot-btn",n.textContent=e.time,n.addEventListener("click",()=>F(e.time,n)),t.appendChild(n)})}const[l,c]=await Promise.all([r("getDayStatus",{date:n,appointmentType:s}),r("getDailySlots",{date:n,shiftType:a})]);if(!l.success||!c.success){t.textContent="";const e=document.createElement("div");return e.style.cssText="grid-column: 1/-1; text-align: center; padding: 20px; color: #dc3545;",e.textContent="Müsait saatler yüklenemedi",void t.appendChild(e)}const d=l.data||l,m=c.data||c,{availableHours:u}=d,{slots:p}=m;t.innerHTML="";const f=new Date,g=n===f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0"),y=f.getHours(),S=f.getMinutes(),h="0"===e.get("specificStaffId");if(0===u.length){const e=document.createElement("div");return e.style.cssText="grid-column: 1/-1; text-align: center; padding: 20px; color: #dc3545;",e.textContent="Bu gün için müsait saat bulunmamaktadır.",void t.appendChild(e)}p.forEach(e=>{if(h&&g){const[t,n]=e.time.split(":").map(Number);if(t<y||t===y&&n<=S)return}const n=document.createElement("div");u.includes(e.hour)?(n.className="slot-btn",n.textContent=e.time,n.addEventListener("click",()=>F(e.time,n))):(n.className="slot-btn slot--disabled",n.textContent=e.time,n.title="Bu saat dolu",n.setAttribute("aria-disabled","true")),t.appendChild(n)})}catch(l){((...e)=>{window.CONFIG?.DEBUG&&console.error(...e)})("displayAvailableTimeSlots error:",l),y(l,{context:"displayAvailableTimeSlots",date:n,shiftType:a}),t.innerHTML='<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #dc3545;">Saatler yüklenirken bir hata oluştu. Lütfen sayfayı yenileyin.</div>'}}function F(n,a){e.set("selectedTime",n);const s=e.get("isManagementLink"),i=e.get("selectedAppointmentType"),o=e.get("selectedStaff"),c=document.querySelector(".slot-btn.selected");if(c&&c.classList.remove("selected"),a.classList.add("selected"),s){e.set("selectedStaff",-1),t("detailsSection");const n=document.getElementById("kvkkContainer");n&&(n.style.display="block");const a=document.getElementById("turnstileContainer");a&&(a.style.display="block");const s=document.getElementById("submitBtn");s&&(s.style.display="block"),l("staffSection")}else if("management"===i&&0===o){l("staffSection"),t("detailsSection");const e=document.getElementById("kvkkContainer");e&&(e.style.display="block");const n=document.getElementById("turnstileContainer");n&&(n.style.display="block");const a=document.getElementById("submitBtn");a&&(a.style.display="block")}else{t("detailsSection");const e=document.getElementById("kvkkContainer");e&&(e.style.display="block");const n=document.getElementById("turnstileContainer");n&&(n.style.display="block");const a=document.getElementById("submitBtn");a&&(a.style.display="block")}}const R={displayAvailableTimeSlots:H,selectTimeSlot:F};"undefined"!=typeof window&&(window.selectTimeSlot=F,window.displayAvailableTimeSlots=H,window.TimeSelector=R);const $=Object.freeze(Object.defineProperty({__proto__:null,TimeSelector:R,displayAvailableTimeSlots:H,selectTimeSlot:F},Symbol.toStringTag,{value:"Module"}));export{u as _,k as a,x as b,p as c,h as d,E as e,S as i,y as l,f as s};
