const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calendar-integration-B0Qyrz8d.js","assets/utils-D-0zHxs0.js"])))=>i.map(i=>d[i]);
import{M as e,s as n,e as t}from"./base-layer-CvqQT6FP.js";import{_ as o,l as a}from"./flow-components-Cx7ZdZvr.js";import{a as r,s as i,b as s,d,e as l}from"./security-zfds8hUd.js";import{S as c,B as u}from"./utils-D-0zHxs0.js";import{a as m}from"./api-IQG5olBT.js";const f=(...e)=>window.CONFIG?.DEBUG&&console.error(...e),w=(...e)=>window.CONFIG?.DEBUG&&console.info(...e);function g(e,n,t,o){const a=document.querySelector(".container");if(!a)return;a.textContent="";const i=r(e,n,t,o);a.appendChild(i),setTimeout(()=>{const e=document.getElementById("addToCalendarBtn");e?e.addEventListener("click",y):f("Add to Calendar button not found!")},100)}async function p(e){const n=e.target.id;try{if(!window.CalendarIntegration){w("Lazy loading calendar-integration...");const e=await o(()=>import("./calendar-integration-B0Qyrz8d.js"),__vite__mapDeps([0,1]));window.CalendarIntegration=e,w("Calendar integration loaded successfully")}switch(n){case"calendarAppleBtn":window.CalendarIntegration.addToCalendarApple();break;case"calendarGoogleBtn":window.CalendarIntegration.addToCalendarGoogle();break;case"calendarOutlookBtn":window.CalendarIntegration.addToCalendarOutlook();break;case"calendarICSBtn":window.CalendarIntegration.downloadICSUniversal()}}catch(t){f("Calendar integration loading error:",t),a(t,{context:"handleCalendarAction",buttonId:e.target.id}),alert("Takvim entegrasyonu yüklenirken bir hata oluştu. Lütfen tekrar deneyin.")}}function y(){e.open("calendarModal")}function I(e){window.turnstileToken=e,window.turnstileVerified=!0;const n=document.getElementById("detailsSection"),t=document.getElementById("submitBtn");t&&n&&"none"!==n.style.display&&(t.style.display="block")}const T={showSuccessPage:g,handleCalendarAction:p,addToCalendar:y,onTurnstileSuccess:I};function k(){try{window.turnstileToken=null,window.turnstileVerified=!1;const e=window.turnstile;if(e){const n=document.getElementById("turnstileWidget");n&&e.reset(n)}}catch(e){}}function C(){const e=document.getElementById("submitBtn");console.error("[FORM] initAppointmentForm called, submitBtn:",!!e),e&&e.addEventListener("click",async e=>{e.preventDefault(),e.stopPropagation();try{await B()}catch(n){console.error("[FORM] UNCAUGHT ERROR IN handleFormSubmit:",n)}})}async function B(){console.error("[SUBMIT] handleFormSubmit ENTERED");const e=document.getElementById("customerName").value,o=document.getElementById("customerPhone").value,r=document.getElementById("customerEmail").value,f=document.getElementById("customerNote").value,w=c.toTitleCase(i(e)),p=s(o),y=d(r),I=l(f,{maxLength:500}),T=n.get("selectedAppointmentType"),C=n.get("selectedDate"),B=n.get("selectedStaff"),v=n.get("selectedTime"),E=n.get("selectedShiftType"),h=n.get("isManagementLink"),S=n.get("managementLevel"),A=n.get("staffMembers"),b=document.getElementById("kvkkConsent");if(!b?.checked){t("Lütfen KVKK aydınlatma metnini okuyup onay veriniz.","error");const e=document.getElementById("kvkkContainer");return void(e&&e.classList.add("error"))}const L=document.getElementById("kvkkContainer");L&&L.classList.remove("error");let N=window.turnstile?.getResponse();if(N||(N=window.turnstileToken),!N)return t("Lütfen robot kontrolünü tamamlayın.","error"),void console.error("[SUBMIT] Turnstile token missing");if(console.error("[SUBMIT] Token found, length:",N.length),!T)return t("Lutfen randevu tipi secin.","error"),void console.error("[SUBMIT] No appointment type");if(!C||null==B||!v)return t("Lutfen tarih, calisan ve saat secin.","error"),void console.error("[SUBMIT] Missing:",{selectedDate:C,selectedStaff:B,selectedTime:v});if(!w||!p)return void t("Lutfen ad ve telefon bilgilerinizi girin.","error");if(!y)return void t("Lutfen e-posta adresinizi girin.","error");const M=document.getElementById("submitBtn");let O,R;u.setLoading(M,"Randevu oluşturuluyor");let P=B;if(h)P=null,O="Atanmadı";else if(0===B)O=window.managementContactPerson||"Yönetim",P=0;else{if(R=A.find(e=>e.id==B),!R)return t("Çalışan bilgisi bulunamadı. Lütfen sayfayı yenileyin.","error"),M.disabled=!1,void(M.textContent="Randevuyu Onayla");O=R.name}try{console.error("[SUBMIT] Making API call createAppointment...");const e=await m("createAppointment",{date:C,time:v,staffId:P,staffName:O,customerName:w,customerPhone:p,customerEmail:y,customerNote:I,shiftType:E,appointmentType:T,duration:window.CONFIG?.APPOINTMENT_HOURS?.interval||30,turnstileToken:N,managementLevel:S,isVipLink:h,kvkkConsent:!0});if(console.error("[SUBMIT] API result:",JSON.stringify(e)),e.success){const e={customerName:w,customerPhone:p,customerEmail:y,customerNote:I,staffName:O,staffPhone:R?.phone||"",staffEmail:R?.email||"",date:C,time:v,appointmentType:T,duration:window.CONFIG?.APPOINTMENT_HOURS?.interval||30};n.set("lastAppointmentData",e),g(C,v,O,I)}else t("Randevu olusturulamadi: "+(e.error||"Bilinmeyen hata"),"error"),u.reset(M),k()}catch(U){console.error("[SUBMIT] CATCH ERROR:",U),a(U,{context:"confirmAppointment",selectedStaff:B,selectedDate:C,selectedTime:v}),t("Randevu oluşturulamadı. Lütfen tekrar deneyiniz.","error"),u.reset(M),k()}}"undefined"!=typeof window&&(window.showSuccessPage=g,window.handleCalendarAction=p,window.addToCalendar=y,window.onTurnstileSuccess=I,window.SuccessPage=T);const v={initAppointmentForm:C};"undefined"!=typeof window&&(window.initAppointmentForm=C,window.AppointmentForm=v,window.handleFormSubmit=B);export{p as h,C as i};
