const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calendar-integration-B0Qyrz8d.js","assets/utils-D-0zHxs0.js"])))=>i.map(i=>d[i]);
import{M as e,s as t,e as n}from"./base-layer-Bx4f0JUd.js";import{_ as o,l as a}from"./flow-components-DEyWMVQ1.js";import{a as i,s as r,b as s,d,e as l}from"./security-DtJpU1t3.js";import{S as c,B as m}from"./utils-D-0zHxs0.js";import{a as u}from"./api-RxvzTxrr.js";const f=(...e)=>window.CONFIG?.DEBUG&&console.error(...e),g=(...e)=>window.CONFIG?.DEBUG&&console.info(...e);function w(e,t,n,o){const a=document.querySelector(".container");if(!a)return;a.textContent="";const r=i(e,t,n,o);a.appendChild(r),setTimeout(()=>{const e=document.getElementById("addToCalendarBtn");e?e.addEventListener("click",y):f("Add to Calendar button not found!")},100)}async function p(e){const t=e.target.id;try{if(!window.CalendarIntegration){g("Lazy loading calendar-integration...");const e=await o(()=>import("./calendar-integration-B0Qyrz8d.js"),__vite__mapDeps([0,1]));window.CalendarIntegration=e,g("Calendar integration loaded successfully")}switch(t){case"calendarAppleBtn":window.CalendarIntegration.addToCalendarApple();break;case"calendarGoogleBtn":window.CalendarIntegration.addToCalendarGoogle();break;case"calendarOutlookBtn":window.CalendarIntegration.addToCalendarOutlook();break;case"calendarICSBtn":window.CalendarIntegration.downloadICSUniversal()}}catch(n){f("Calendar integration loading error:",n),a(n,{context:"handleCalendarAction",buttonId:e.target.id}),alert("Takvim entegrasyonu yüklenirken bir hata oluştu. Lütfen tekrar deneyin.")}}function y(){e.open("calendarModal")}function C(e){window.turnstileVerified=!0;const t=document.getElementById("detailsSection"),n=document.getElementById("submitBtn");n&&t&&"none"!==t.style.display&&(n.style.display="block")}const I={showSuccessPage:w,handleCalendarAction:p,addToCalendar:y,onTurnstileSuccess:C};function k(){try{const e=window.turnstile;if(e){const t=document.getElementById("turnstileWidget");t&&e.reset(t)}}catch(e){}}function v(){const e=document.getElementById("submitBtn");e&&e.addEventListener("click",T)}async function T(){const e=document.getElementById("customerName").value,o=document.getElementById("customerPhone").value,i=document.getElementById("customerEmail").value,f=document.getElementById("customerNote").value,g=c.toTitleCase(r(e)),p=s(o),y=d(i),C=l(f,{maxLength:500}),I=t.get("selectedAppointmentType"),v=t.get("selectedDate"),T=t.get("selectedStaff"),B=t.get("selectedTime"),E=t.get("selectedShiftType"),h=t.get("isManagementLink"),L=t.get("managementLevel"),S=t.get("staffMembers"),b=document.getElementById("kvkkConsent");if(!b?.checked){n("Lütfen KVKK aydınlatma metnini okuyup onay veriniz.","error");const e=document.getElementById("kvkkContainer");return void(e&&e.classList.add("error"))}const A=document.getElementById("kvkkContainer");A&&A.classList.remove("error");const N=window.turnstile?.getResponse();if(!N)return n("Lütfen robot kontrolünü tamamlayın.","error"),void console.error("[SUBMIT] Turnstile token missing");if(!I)return n("Lutfen randevu tipi secin.","error"),void console.error("[SUBMIT] No appointment type");if(!v||null==T||!B)return n("Lutfen tarih, calisan ve saat secin.","error"),void console.error("[SUBMIT] Missing:",{selectedDate:v,selectedStaff:T,selectedTime:B});if(!g||!p)return void n("Lutfen ad ve telefon bilgilerinizi girin.","error");if(!y)return void n("Lutfen e-posta adresinizi girin.","error");const P=document.getElementById("submitBtn");let O,M;m.setLoading(P,"Randevu oluşturuluyor");let G=T;if(h)G=null,O="Atanmadı";else if(0===T)O=window.managementContactPerson||"Yönetim",G=0;else{if(M=S.find(e=>e.id==T),!M)return n("Çalışan bilgisi bulunamadı. Lütfen sayfayı yenileyin.","error"),P.disabled=!1,void(P.textContent="Randevuyu Onayla");O=M.name}try{const e=await u("createAppointment",{date:v,time:B,staffId:G,staffName:O,customerName:g,customerPhone:p,customerEmail:y,customerNote:C,shiftType:E,appointmentType:I,duration:window.CONFIG?.APPOINTMENT_HOURS?.interval||30,turnstileToken:N,managementLevel:L,isVipLink:h,kvkkConsent:!0});if(e.success){const e={customerName:g,customerPhone:p,customerEmail:y,customerNote:C,staffName:O,staffPhone:M?.phone||"",staffEmail:M?.email||"",date:v,time:B,appointmentType:I,duration:window.CONFIG?.APPOINTMENT_HOURS?.interval||30};t.set("lastAppointmentData",e),w(v,B,O,C)}else n("Randevu olusturulamadi: "+(e.error||"Bilinmeyen hata"),"error"),m.reset(P),k()}catch(R){a(R,{context:"confirmAppointment",selectedStaff:T,selectedDate:v,selectedTime:B}),n("Randevu oluşturulamadı. Lütfen tekrar deneyiniz.","error"),m.reset(P),k()}}"undefined"!=typeof window&&(window.showSuccessPage=w,window.handleCalendarAction=p,window.addToCalendar=y,window.onTurnstileSuccess=C,window.SuccessPage=I);const B={initAppointmentForm:v};"undefined"!=typeof window&&(window.initAppointmentForm=v,window.AppointmentForm=B);export{p as h,v as i};
