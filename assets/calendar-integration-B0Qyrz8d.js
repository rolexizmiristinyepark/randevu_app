import{S as e,D as n}from"./utils-D-0zHxs0.js";const t={delivery:"Saat Takdimi",service:"Servis & Bakım",consultation:"Ürün Danışmanlığı",general:"Genel Görüşme",meeting:"Genel Görüşme",management:"Yönetim"},a=()=>window.CONFIG||{},o=()=>window.ModalUtils||{open:()=>{},close:()=>{}},i=()=>window.lastAppointmentData;function r(){const e=navigator.userAgent,n=navigator.platform||"";return{ios:/iPhone|iPad|iPod/.test(e)&&!window.MSStream,android:/Android/.test(e),macos:/Mac/.test(n)&&!/iPhone|iPad|iPod/.test(e),windows:/Win/.test(n),safari:/Safari/.test(e)&&!/Chrome|CriOS/.test(e),chrome:/Chrome|CriOS/.test(e)&&!/Edg/.test(e),firefox:/Firefox|FxiOS/.test(e),edge:/Edg/.test(e),mobile:/iPhone|iPad|iPod|Android/.test(e)}}function s(){const n=i();if(!n)return null;const o=a();n.staffName=e.toTitleCase(n.staffName||"");const r=new Date(n.date+"T"+n.time),s=n.duration||o.APPOINTMENT_HOURS?.interval||60,d=new Date(r.getTime()+6e4*s),l=t[n.appointmentType]||o.APPOINTMENT_TYPES?.find(e=>e.value===n.appointmentType)?.name||"Genel",c=`İzmir İstinyepark Rolex - ${n.staffName} (${l})`;let m="RANDEVU BİLGİLERİ\n\n";return m+=`İlgili: ${n.staffName}\n`,m+=`İletişim: ${n.staffPhone||"Belirtilmedi"}\n`,m+=`E-posta: ${n.staffEmail||"Belirtilmedi"}\n`,m+=`Tarih: ${new Date(n.date).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"})}\n`,m+=`Saat: ${n.time}\n`,m+=`Konu: ${l}\n`,n.customerNote&&(m+=`Ek Bilgi: ${n.customerNote}\n`),m+="\nRandevunuza zamanında gelmenizi rica ederiz.\nLütfen kimlik belgenizi yanınızda bulundurun.",{appointment:n,date:r,endDate:d,title:c,details:m,appointmentTypeName:l}}function d(e,n=2e3){return new Promise(t=>{let a=!1;const o=()=>{document.hidden&&!a&&(a=!0,document.removeEventListener("visibilitychange",o),t(!0))};document.addEventListener("visibilitychange",o);const i=()=>{a||(a=!0,window.removeEventListener("blur",i),document.removeEventListener("visibilitychange",o),t(!0))};window.addEventListener("blur",i);const r=document.createElement("iframe");r.style.display="none",r.src=e,document.body.appendChild(r),setTimeout(()=>{a||(window.location.href=e)},100),setTimeout(()=>{a||(a=!0,window.removeEventListener("blur",i),document.removeEventListener("visibilitychange",o),r.parentNode&&document.body.removeChild(r),t(!1))},n)})}function l(e=!0){const n=s();if(!n)return;const t=E(n.date,n.endDate),a=r();if(a.ios&&a.safari){const e=`data:text/calendar;base64,${btoa(unescape(encodeURIComponent(t)))}`;return void(window.location.href=e)}if(a.ios&&!a.safari){const e=`data:text/calendar;base64,${btoa(unescape(encodeURIComponent(t)))}`;return void(window.open(e,"_blank")||c("Dosya indirilemiyor. Popup izni verin veya Safari kullanın.","info"))}const o=new Blob([t],{type:"text/calendar"}),i=URL.createObjectURL(o),d=document.createElement("a");d.href=i,d.download="rolex-randevu.ics",d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{d.parentNode&&document.body.removeChild(d),URL.revokeObjectURL(i)},100)}function c(e,n="success"){const t=document.querySelector(".toast");t&&t.remove();const a=document.createElement("div");a.className=`toast toast-${n}`,a.textContent=e,a.style.cssText=`\n        position: fixed;\n        bottom: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: ${"success"===n?"#4CAF50":"error"===n?"#f44336":"#2196F3"};\n        color: white;\n        padding: 12px 24px;\n        border-radius: 4px;\n        font-size: 14px;\n        z-index: 10001;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        animation: slideUp 0.3s ease;\n    `,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",a.style.transition="opacity 0.3s",setTimeout(()=>a.remove(),300)},3e3)}function m(){o().open("calendarModal")}async function u(){const e=s();if(!e)return alert("Randevu bilgileri bulunamadı. Lütfen tekrar deneyin."),void o().close("calendarModal");const n=r();if(o().close("calendarModal"),n.ios&&n.safari){const n=E(e.date,e.endDate),t=`data:text/calendar;base64,${btoa(unescape(encodeURIComponent(n)))}`;return window.location.href=t,void c("Apple Calendar açılıyor...","success")}return n.macos&&n.safari?(l(!0),void c("Apple Calendar açılıyor...","success")):n.ios||n.macos?(l(!0),void c("Takvim dosyası indirildi. Açarak takvime ekleyin.","info")):(l(!0),void c("Takvim dosyası indirildi","success"))}async function p(){const e=s();if(!e)return alert("Randevu bilgileri bulunamadı. Lütfen tekrar deneyin."),void o().close("calendarModal");const n=r();if(o().close("calendarModal"),n.android){const n=e=>e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),t=`intent://calendar.google.com/calendar/r/eventedit?text=${encodeURIComponent(e.title)}&dates=${n(e.date)}/${n(e.endDate)}&location=${encodeURIComponent("Rolex İzmir İstinyepark")}&details=${encodeURIComponent(e.details)}#Intent;scheme=https;package=com.google.android.calendar;end`;try{if(await d(t,1500))return void c("Google Calendar açıldı","success")}catch(a){}}const t=function(){const e=s();if(!e)return"";const n=e=>e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),t=new URL("https://calendar.google.com/calendar/render");return t.searchParams.set("action","TEMPLATE"),t.searchParams.set("text",e.title),t.searchParams.set("dates",`${n(e.date)}/${n(e.endDate)}`),t.searchParams.set("details",e.details),t.searchParams.set("location","Rolex İzmir İstinyepark"),t.searchParams.set("ctz","Europe/Istanbul"),t.toString()}();window.open(t,"_blank")?c("Google Calendar açılıyor...","success"):(l(!0),c("Popup engellendi. Takvim dosyası indirildi.","info"))}async function f(){const e=s();if(!e)return alert("Randevu bilgileri bulunamadı. Lütfen tekrar deneyin."),void o().close("calendarModal");const n=r();if(o().close("calendarModal"),n.windows){const n=e=>e.toISOString(),t=`ms-outlook://calendar/create?subject=${encodeURIComponent(e.title)}&startdt=${encodeURIComponent(n(e.date))}&enddt=${encodeURIComponent(n(e.endDate))}&location=${encodeURIComponent("Rolex İzmir İstinyepark")}&body=${encodeURIComponent(e.details)}`;try{if(await d(t,1500))return void c("Outlook açıldı","success")}catch(a){}}const t=function(){const e=s();if(!e)return"";const n=new URL("https://outlook.live.com/calendar/0/deeplink/compose");return n.searchParams.set("path","/calendar/action/compose"),n.searchParams.set("rru","addevent"),n.searchParams.set("subject",e.title),n.searchParams.set("startdt",e.date.toISOString()),n.searchParams.set("enddt",e.endDate.toISOString()),n.searchParams.set("body",e.details),n.searchParams.set("location","Rolex İzmir İstinyepark"),n.toString()}();window.open(t,"_blank")?c("Outlook Calendar açılıyor...","success"):(l(!0),c("Popup engellendi. Takvim dosyası indirildi.","info"))}function T(){if(!s())return alert("Randevu bilgileri bulunamadı. Lütfen tekrar deneyin."),void o().close("calendarModal");o().close("calendarModal"),l(!0),c("Takvim dosyası indirildi","success")}function E(o,r){const s=i(),d=a();let l="RANDEVU BİLGİLERİ\\n\\n",c="Rolex Randevu",m=[];if(s){s.staffName=e.toTitleCase(s.staffName||"");const n=t[s.appointmentType]||d.APPOINTMENT_TYPES?.find(e=>e.value===s.appointmentType)?.name||"Genel";c=`İzmir İstinyepark Rolex - ${s.staffName} (${n})`;const a={year:"numeric",month:"long",day:"numeric"},o=new Date(s.date).toLocaleDateString("tr-TR",a);l+=`İlgili: ${s.staffName}\\n`,l+=`İletişim: ${s.staffPhone||"Belirtilmedi"}\\n`,l+=`E-posta: ${s.staffEmail||"Belirtilmedi"}\\n`,l+=`Tarih: ${o}\\n`,l+=`Saat: ${s.time}\\n`,l+=`Konu: ${n}\\n`,s.customerNote&&(l+=`Ek Bilgi: ${s.customerNote}\\n`),l+="\\nRandevunuza zamanında gelmenizi rica ederiz.\\nLütfen kimlik belgenizi yanınızda bulundurun.",m=[{trigger:"-P1D",description:"Yarın randevunuz var. Lütfen kimlik belgenizi yanınızda bulundurun."},{trigger:"-PT1H",description:"1 saat sonra randevunuz var. Lütfen zamanında gelin."}];const i=parseInt((s.time||"12:00").split(":")[0])-10;i>0&&m.splice(1,0,{trigger:`-PT${i}H`,description:"Bugün randevunuz var. Rolex İzmir İstinyepark."})}const u=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Rolex İzmir İstinyepark//Randevu Sistemi//TR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VTIMEZONE","TZID:Europe/Istanbul","BEGIN:STANDARD","DTSTART:19701025T040000","RRULE:FREQ=YEARLY;BYDAY=-1SU;BYMONTH=10","TZOFFSETFROM:+0300","TZOFFSETTO:+0300","TZNAME:+03","END:STANDARD","END:VTIMEZONE","BEGIN:VEVENT",`UID:rolex-${Date.now()}@istinyepark.com`,`DTSTAMP:${n.toICSDate(new Date)}Z`,`DTSTART;TZID=Europe/Istanbul:${n.toICSDate(o)}`,`DTEND;TZID=Europe/Istanbul:${n.toICSDate(r)}`,`SUMMARY:${c}`,`DESCRIPTION:${l}`,"LOCATION:Rolex İzmir İstinyepark","STATUS:CONFIRMED","ORGANIZER;CN=Rolex İzmir İstinyepark:mailto:istinyeparkrolex35@gmail.com"];return m.forEach(e=>{u.push("BEGIN:VALARM",`TRIGGER:${e.trigger}`,"ACTION:DISPLAY",`DESCRIPTION:${e.description}`,"END:VALARM")}),u.push("END:VEVENT","END:VCALENDAR"),u.join("\r\n")}export{u as addToCalendarApple,p as addToCalendarGoogle,f as addToCalendarOutlook,T as downloadICSUniversal,E as generateICS,m as openCalendarModal};
